<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Panel - Andrés Raíz</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="panel">
    <img src="assets/logo.png" class="logo" alt="Logo"/>
    <h2>Bienvenido, <span id="nombre"></span></h2>

    <div class="info-box">
      <p><strong>Cédula:</strong> <span id="cedula"></span></p>
      <p><strong>Cargo:</strong> <span id="cargo"></span></p>
      <p><strong>Fecha de ingreso:</strong> <span id="ingreso"></span></p>
      <p><strong>Vacaciones disfrutadas:</strong> <span id="vacaciones_tomadas"></span> días</p>
      <p><strong>Vacaciones disponibles:</strong> <span id="vacaciones_disponibles"></span> días</p>
    </div>

    <div class="btn-group">
      <button onclick="descargarColilla()">Ver colilla de este mes</button>
      <button onclick="generarCertificado()">Generar certificado laboral</button>
      <button onclick="cerrarSesion()">Cerrar sesión</button>
      <a href="admin.html"><button>➕ Agregar empleado</button></a>
    </div>

    <iframe id="visor" style="display:none;" width="100%" height="500px"></iframe>
  </div>

  <script>
    const empleado = JSON.parse(localStorage.getItem('empleado'));
    if (!empleado) {
      window.location.href = "index.html";
    }

    function normalizarFecha(fechaTexto) {
      const meses = {
        'enero': '01', 'febrero': '02', 'marzo': '03', 'abril': '04',
        'mayo': '05', 'junio': '06', 'julio': '07', 'agosto': '08',
        'septiembre': '09', 'octubre': '10', 'noviembre': '11', 'diciembre': '12'
      };
      const partes = fechaTexto.toLowerCase().split(' de ');
      if (partes.length !== 3) return fechaTexto;
      return `${partes[2]}-${meses[partes[1]]}-${partes[0].padStart(2, '0')}`;
    }

    document.getElementById('nombre').innerText = empleado.nombre;
    document.getElementById('cedula').innerText = empleado.cedula;
    document.getElementById('cargo').innerText = empleado.cargo;
    document.getElementById('ingreso').innerText = empleado.ingreso;

    const fechaNormalizada = normalizarFecha(empleado.ingreso);
    const fechaIngreso = new Date(fechaNormalizada);
    const hoy = new Date();
    const totalMeses = (hoy.getFullYear() - fechaIngreso.getFullYear()) * 12 + (hoy.getMonth() - fechaIngreso.getMonth());
    const vacacionesAcumuladas = Math.floor((15 / 12) * totalMeses); // 15 días al año
    const vacacionesTomadas = empleado.vacaciones || 0;
    const vacacionesDisponibles = Math.max(vacacionesAcumuladas - vacacionesTomadas, 0);

    document.getElementById('vacaciones_acumuladas').innerText = vacacionesAcumuladas;
    document.getElementById('vacaciones_tomadas').innerText = vacacionesTomadas;
    document.getElementById('vacaciones_disponibles').innerText = vacacionesDisponibles;

    function descargarColilla() {
      const mes = new Date().toISOString().slice(0, 7);
      const path = `colillas/${empleado.cedula}/${mes}.pdf`;
      const visor = document.getElementById("visor");
      visor.removeAttribute('src');
      visor.style.display = "block";
      setTimeout(() => visor.src = path, 100);
    }

    function cerrarSesion() {
      localStorage.removeItem('empleado');
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
